---
import MainLayout from "../layouts/MainLayout.astro";
---

<MainLayout title="Eidolon Capital Intranet - Login">
  <div class="window">
    <div class="title-bar">
      <div class="title-bar-text">Eidolon Capital - Secure Login</div>
    </div>
    <div class="window-body">
      <h3 class="window-header">Authorized Access Only</h3>
      <div class="field-border warning-box">
        <strong>⚠️ WARNING</strong><br />
        <p>All access to the Eidolon Capital Corporate Intranet is strictly controlled and monitored.</p>
        <p>Any unauthorized access will be prosecuted under EID-ORD-6998 and result in immediate termination.</p>
      </div>

      <button type="button" class="login-button" id="loginButton">Login</button>

      <div class="progress-indicator segmented progress-container hidden" id="progressBar">
        <span class="progress-indicator-bar" id="progressBarFill"></span>
      </div>

      <div class="status-bar">
        <div class="status-bar-field">Eidolon Capital Security Gateway</div>
        <div class="status-bar-field">v1.65.267</div>
      </div>
    </div>
  </div>
</MainLayout>

<style>
  .window-header {
    text-align: center;
  }
  .login-window {
    width: 300px;
    margin: 0 auto;
  }
  .warning-box {
    padding: 10px;
    margin-bottom: 10px;
  }
  .login-button {
    font-size: 20px;
    width: 70%;
    height: 40px;
    margin: 20px auto 30px auto;
    display: block;
  }
  .progress-container {
    margin: 10px auto;
    width: 70%;
  }
  .hidden {
    display: none;
  }
</style>

<script>
  const loginButton = document.getElementById("loginButton") as HTMLButtonElement;
  const progressBar = document.getElementById("progressBar") as HTMLDivElement;
  const progressBarFill = document.getElementById("progressBarFill") as HTMLSpanElement;

  loginButton.addEventListener("click", () => {
    // Disable button and show progress bar
    loginButton.disabled = true;
    loginButton.innerText = "Logging In";
    progressBar.classList.remove("hidden");

    // Animate progress bar over 1.5 seconds
    const duration = 1500;
    const startTime = Date.now();

    const animate = () => {
      const elapsed = Date.now() - startTime;
      let progress = Math.min((elapsed / duration) * 100, 100);
      progress = progress - (progress % 10)
      
      progressBarFill.style.width = `${progress}%`;

      if (elapsed < duration) {
        requestAnimationFrame(animate);
      } else {
        window.location.href = "/dashboard";
      }
    };

    requestAnimationFrame(animate);
  });
</script>
